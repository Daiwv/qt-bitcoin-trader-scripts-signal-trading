[JLScript]
Version=1
Name=SignalTrader
Notes=
Encrypted=false
LogRowsCount=500
Data="var variablePath = \"C:\\\\Users\\\\Damjan\\\\Documents\\\\GitHub\\\\qt-bitcoin-trader-scripts-signal-trading\\\\\";\nvar signal1StatusFile = variablePath + \"Signal1Status.txt\"; \nvar signal2StatusFile = variablePath + \"Signal2Status.txt\"; \nvar signal3StatusFile = variablePath + \"Signal3Status.txt\"; \nvar signal4StatusFile = variablePath + \"Signal4Status.txt\"; \nvar signal1Status = \"\";\nvar signal2Status = \"\";\nvar signal3Status = \"\";\nvar signal4Status = \"\";\nvar lastBuyPriceFile = variablePath + \"lastBuyPrice.txt\";\nvar lastSellPriceFile = variablePath + \"lastSellPrice.txt\";\nvar lastBuyPrice = 0;\nvar lastBuyPriceOld = 0;\nvar lastSellPrice = 0;\nvar lastSellPriceOld = 0;\nvar currencyPrimary = \"USD\";\nvar currencySecondary = \"BTC\";\nvar feeMaker = 0.001;\nvar feeTaker = 0.002;\nvar openAsksCountOld = 0;\nvar openBidsCountOld = 0;\nvar minPrimaryCurrencyBalanceForSale = 100;\nvar minSecondaryCurrencyBalanceForSale = 0.01;\ntrader.fileWrite(lastSellPriceFile, lastSellPrice);\ntrader.fileWrite(lastSellPriceFile, lastSellPrice);\n//////////////////////////////////////////////////////////////////////////////////////////////\n///////////////                  log to file or window                     ///////////////////\n//////////////////////////////////////////////////////////////////////////////////////////////\nvar logToFile = true;\nvar logToWindow = true;\nvar logFile = variablePath + \"SignalTraderLogger.txt\";\n\nfunction eventLogger(tempString) {\n    if (logToFile)\n        trader.fileAppend(logFile, trader.dateTimeString() + \": \" + tempString);\n    if (logToWindow)\n        trader.log(tempString);\n}\n//////////////////////////////////////////////////////////////////////////////////////////////\n///////////////                       functions                            ///////////////////\n//////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction readSignalFiles() {\n    var scriptName = \"readSignalFiles()\";\n    eventLogger(scriptName + \".START\");\n\n    signal1Status = trader.fileReadAll(signal1StatusFile).toString().trim();\n    signal2Status = trader.fileReadAll(signal2StatusFile).toString().trim();\n    signal3Status = trader.fileReadAll(signal3StatusFile).toString().trim();\n    signal4Status = trader.fileReadAll(signal4StatusFile).toString().trim();\n\n    eventLogger(scriptName + \".signal1Status: \" + signal1Status);\n    eventLogger(scriptName + \".signal2Status: \" + signal2Status);\n    eventLogger(scriptName + \".signal3Status: \" + signal3Status);\n    eventLogger(scriptName + \".signal4Status: \" + signal4Status);\n\n    eventLogger(scriptName + \".END\");\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction makeBuy() {\n    var scriptName = \"makeBuy()\";\n    eventLogger(scriptName + \".START\");\n\n    readSignalFiles();\n\n    if (canMakeBuy()) {\n        eventLogger(scriptName + \".STEP 1\");\n        var lastCurrencyPrimaryBalance = trader.get(\"Balance\", currencyPrimary);\n        var lastCurrencySecondaryBalance = trader.get(\"Balance\", currencySecondary);\n        eventLogger(scriptName + \".lastCurrencyPrimaryBalance: \" + lastCurrencyPrimaryBalance);\n        trader.cancelBids(currencySecondary + currencyPrimary);\n        if (lastCurrencyPrimaryBalance > minPrimaryCurrencyBalanceForSale) {\n            eventLogger(scriptName + \".lastCurrencyPrimaryBalance: \" + lastCurrencyPrimaryBalance);\n            eventLogger(scriptName + \".lastBuyPrice: \" + lastBuyPrice);\n            if (lastBuyPrice == 0) {\n                lastBuyPrice = trader.get(\"LastPrice\");\n            } else {\n                lastBuyPrice = trader.get(\"LastMyBuyPrice\");\n            }\n\n            eventLogger(scriptName + \".lastBuyPrice: \" + lastBuyPrice);\n            \n            var primaryBalanceBeforeLastSell = lastBuyPrice / ((1 - feeTaker) * 1000) * 1000;\n            var secondaryBalanceBeforeLastSell = lastCurrencySecondaryBalance / ((1 - feeTaker) * 1000) * 1000;\n            eventLogger(scriptName + \".secondaryBalanceBeforeLastSell: \" + secondaryBalanceBeforeLastSell);\n            eventLogger(scriptName + \".primaryBalanceBeforeLastSell: \" + primaryBalanceBeforeLastSell);\n            var secondaryBalanceOnePromile = secondaryBalanceBeforeLastSell / ((1 - feeTaker) * 1000);\n            var primaryBalanceOnePromile = primaryBalanceBeforeLastSell / ((1 - feeTaker) * 1000);\n            eventLogger(scriptName + \".secondaryBalanceOnePromile: \" + secondaryBalanceOnePromile);\n            eventLogger(scriptName + \".primaryBalanceOnePromile: \" + primaryBalanceOnePromile);\n            var newWantedSecondaryBalance = secondaryBalanceOnePromile * 1000 + secondaryBalanceOnePromile * feeMaker * 1000;\n            var newWantedPrimaryBalance = primaryBalanceOnePromile * 1000 + primaryBalanceOnePromile * feeMaker * 1000;\n            eventLogger(scriptName + \".newWantedSecondaryBalance: \" + newWantedSecondaryBalance);\n            eventLogger(scriptName + \".newWantedPrimaryBalance: \" + newWantedPrimaryBalance);\n            \n            var lastCurrencyPrimaryBalance = trader.get(\"Balance\", currencyPrimary);\n            var lastPrice = trader.get(\"LastPrice\");\n            var buyAmount = lastCurrencyPrimaryBalance / lastPrice;\n            buyAmount = buyAmount - 0.00001;\n            eventLogger(scriptName + \".lastCurrencyPrimaryBalance: \" + lastCurrencyPrimaryBalance);\n            eventLogger(scriptName + \".lastPrice: \" + lastPrice);\n            eventLogger(scriptName + \".buyAmount: \" + buyAmount);\n            if(lastPrice < newWantedPrimaryBalance)\n                trader.buy(currencySecondary + currencyPrimary, buyAmount, lastPrice);            \n            else\n                trader.buy(currencySecondary + currencyPrimary, buyAmount, newWantedPrimaryBalance);           \n                \n            resetSignalSellFilesStatus();\n        }\n        resetSignalBuyFilesStatus();\n    }\n\n    eventLogger(scriptName + \".END\");\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction canMakeSell() {\n    var scriptName = \"canMakeSell()\";\n    eventLogger(scriptName + \".START\");\n\n    var makeSellCondition = false;\n    var openAsks = trader.get(\"OpenAsksCount\");\n    eventLogger(scriptName + \".openAsks: \" + openAsks);\n    if (openAsks > 0) {\n        eventLogger(scriptName + \".STEP 1\");\n        return true;\n    }\n\n    eventLogger(scriptName + \".signal3Status: \" + signal3Status);\n    eventLogger(scriptName + \".signal4Status: \" + signal4Status);\n\n    if (signal3Status == \"TRUE\" && signal4Status == \"TRUE\") {\n        eventLogger(scriptName + \".STEP 2\");\n        return true;\n    }\n\n    eventLogger(scriptName + \".END\");\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction makeSell() {\n    var scriptName = \"makeSell()\";\n    eventLogger(scriptName + \".START\");\n    readSignalFiles();\n    if (canMakeSell()) {\n        eventLogger(scriptName + \".STEP 1\");\n        var lastCurrencyPrimaryBalance = trader.get(\"Balance\", currencyPrimary);\n        var lastCurrencySecondaryBalance = trader.get(\"Balance\", currencySecondary);\n        trader.cancelAsks(currencySecondary + currencyPrimary);\n        eventLogger(scriptName + \".lastCurrencyPrimaryBalance: \" + lastCurrencyPrimaryBalance);\n        if (lastCurrencySecondaryBalance > minSecondaryCurrencyBalanceForSale) {\n            eventLogger(scriptName + \".lastCurrencySecondaryBalance: \" + lastCurrencySecondaryBalance);\n            eventLogger(scriptName + \".lastSellPrice: \" + lastSellPrice);\n            if (lastSellPrice == 0) {\n                lastSellPrice = trader.get(\"LastPrice\");\n            } else {\n                lastSellPrice = trader.get(\"LastMySellPrice\");\n            }\n            eventLogger(scriptName + \".lastSellPrice: \" + lastSellPrice);            \n            var primaryBalanceBeforeLastBuy = lastBuyPrice / ((1 - feeMaker) * 1000) * 1000;\n            var secondaryBalanceBeforeLastBuy = lastCurrencySecondaryBalance / ((1 - feeMaker) * 1000) * 1000;\n            eventLogger(scriptName + \".secondaryBalanceBeforeLastBuy: \" + secondaryBalanceBeforeLastBuy);\n            eventLogger(scriptName + \".primaryBalanceBeforeLastBuy: \" + primaryBalanceBeforeLastBuy);            \n            var secondaryBalanceOnePromile = secondaryBalanceBeforeLastBuy / ((1 - feeMaker) * 1000);\n            var primaryBalanceOnePromile = primaryBalanceBeforeLastBuy / ((1 - feeMaker) * 1000);\n            eventLogger(scriptName + \".secondaryBalanceOnePromile: \" + secondaryBalanceOnePromile);\n            eventLogger(scriptName + \".primaryBalanceOnePromile: \" + primaryBalanceOnePromile);            \n            var newWantedSecondaryBalance = secondaryBalanceOnePromile * 1000 + secondaryBalanceOnePromile * feeTaker * 1000;\n            var newWantedPrimaryBalance = primaryBalanceOnePromile * 1000 + primaryBalanceOnePromile * feeTaker * 1000;\n            eventLogger(scriptName + \".newWantedSecondaryBalance: \" + newWantedSecondaryBalance);\n            eventLogger(scriptName + \".newWantedPrimaryBalance: \" + newWantedPrimaryBalance);\n                        \n            var lastCurrencySecondaryBalance = trader.get(\"Balance\", currencySecondary);\n            var lastPrice = trader.get(\"LastPrice\");\n            var sellAmount = lastCurrencySecondaryBalance;\n            var sellPrice = newWantedPrimaryBalance;\n            sellAmount = sellAmount - 0.00001;\n            eventLogger(scriptName + \".lastCurrencySecondaryBalance: \" + lastCurrencySecondaryBalance);\n            eventLogger(scriptName + \".lastPrice: \" + lastPrice);\n            eventLogger(scriptName + \".sellAmount: \" + sellAmount);\n            eventLogger(scriptName + \".sellPrice: \" + sellPrice);\n            if(lastPrice > sellPrice)\n                trader.sell(currencySecondary + currencyPrimary, sellAmount, lastPrice);            \n            else\n                trader.sell(currencySecondary + currencyPrimary, sellAmount, sellPrice);\n            \n            resetSignalBuyFilesStatus();\n        }\n        resetSignalSellFilesStatus();\n    }\n    eventLogger(scriptName + \".END\");\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction resetSignalBuyFilesStatus() {\n    var scriptName = \"resetSignalBuyFilesStatus()\";\n    eventLogger(scriptName + \".START\");\n\n    trader.fileWrite(signal1StatusFile, \"FALSE\");\n    trader.fileWrite(signal2StatusFile, \"FALSE\");\n\n    eventLogger(scriptName + \".END\");\n}\n\nfunction resetSignalSellFilesStatus() {\n    var scriptName = \"resetSignalSellFilesStatus()\";\n    eventLogger(scriptName + \".START\");\n\n    trader.fileWrite(signal3StatusFile, \"FALSE\");\n    trader.fileWrite(signal4StatusFile, \"FALSE\");\n\n    eventLogger(scriptName + \".END\");\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction canMakeBuy() {\n    var scriptName = \"canMakeBuy()\";\n    eventLogger(scriptName + \".START\");\n\n    var makeBuyCondition = false;\n    var openBids = trader.get(\"OpenBidsCount\");\n    eventLogger(scriptName + \".openBids: \" + openBids);\n\n    if (openBids > 0) {\n        eventLogger(scriptName + \".STEP 1\");\n        return true;\n    }\n    \n\n    eventLogger(scriptName + \".signal1Status: \" + signal1Status);\n    eventLogger(scriptName + \".signal2Status: \" + signal2Status);\n    if (signal1Status == \"TRUE\" && signal2Status == \"TRUE\") {\n        eventLogger(scriptName + \".STEP 2\");\n        return true;\n    }\n\n    eventLogger(scriptName + \".END\");\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction writeLastBuyPrice() {\n    var scriptName = \"writeLastBuyPrice()\";\n    eventLogger(scriptName + \".START\");\n\n    lastBuyPrice = trader.get(\"LastMyBuyPrice\");\n    eventLogger(scriptName + \".lastBuyPrice: \" + lastBuyPrice);\n    trader.fileWrite(lastBuyPriceFile, lastBuyPrice);\n\n    eventLogger(scriptName + \".END\");\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction readLastBuyPrice() {\n    var scriptName = \"readLastBuyPrice()\";\n    eventLogger(scriptName + \".START\");\n\n    lastBuyPrice = parseFloat(trader.fileReadAll(lastBuyPriceFile).toString().trim());\n    eventLogger(scriptName + \".lastBuyPrice: \" + lastBuyPrice);\n    if (lastBuyPrice != 0) {\n        lastBuyPrice = trader.get(\"LastMyBuyPrice\");\n        eventLogger(scriptName + \".lastBuyPrice: \" + lastBuyPrice);        \n    }\n    eventLogger(scriptName + \".END\");\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction writeLastSellPrice() {\n    var scriptName = \"writeLastSellPrice()\";\n    eventLogger(scriptName + \".START\");\n\n    lastSellPrice = trader.get(\"LastMySellPrice\");\n    eventLogger(scriptName + \".lastSellPrice: \" + lastSellPrice);\n    trader.fileWrite(lastSellPriceFile, lastSellPrice);\n\n    eventLogger(scriptName + \".END\");\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction readLastSellPrice() {\n    var scriptName = \"readLastSellPrice()\";\n    eventLogger(scriptName + \".START\");\n\n    lastSellPrice = parseFloat(trader.fileReadAll(lastSellPriceFile).toString().trim());\n    eventLogger(scriptName + \".lastSellPrice: \" + lastSellPrice);\n    if (lastSellPrice != 0) {\n        lastSellPrice = trader.get(\"LastMySellPrice\");\n        eventLogger(scriptName + \".lastSellPrice: \" + lastSellPrice);           \n    }\n\n    eventLogger(scriptName + \".END\");\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction compareLastBuyPrice() {\n    var scriptName = \"compareLastBuyPrice()\";\n    eventLogger(scriptName + \".START\");\n\n    if (lastBuyPrice != 0) {\n        lastBuyPrice = trader.get(\"LastMyBuyPrice\");\n        if (lastBuyPrice != lastBuyPriceOld) {\n            resetSignalBuyFilesStatus();\n            lastBuyPriceOld = lastBuyPrice;\n            writeLastBuyPrice();\n        }\n    }\n\n    eventLogger(scriptName + \".END\");\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction compareLastSellPrice() {\n    var scriptName = \"compareLastSellPrice()\";\n    eventLogger(scriptName + \".START\");\n\n    if (lastSellPrice != 0) {\n        lastSellPrice = trader.get(\"LastMySellPrice\");\n        if (lastSellPrice != lastSellPriceOld) {\n            resetSignalSellFilesStatus();\n            lastSellPriceOld = lastSellPrice;\n            writeLastSellPrice();\n        }\n    }\n\n\n    eventLogger(scriptName + \".END\");\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction startEverything() {\n    var scriptName = \"startEverything()\";\n    eventLogger(scriptName + \".START\");\n\n    readSignalFiles();\n\n    eventLogger(scriptName + \".lastBuyPrice: \" + lastBuyPrice);\n    if (lastBuyPrice == 0) {\n        readLastBuyPrice();\n    }\n\n    eventLogger(scriptName + \".lastSellPrice: \" + lastSellPrice);\n    if (lastSellPrice == 0) {\n        readLastSellPrice();\n    }\n\n    compareLastBuyPrice();\n    compareLastSellPrice();\n\n    makeSell();\n    makeBuy();\n\n    eventLogger(scriptName + \".END\");\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////\n///////////////                      main program                          ///////////////////\n//////////////////////////////////////////////////////////////////////////////////////////////\n\ntrader.timer(60, \"startEverything()\");"
